<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Command-line interface - Minimum Anti-Collusion Infrastructure</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li class="chapter-item expanded "><a href="primitives.html"><strong aria-hidden="true">3.</strong> MACI Primitives</a></li><li class="chapter-item expanded "><a href="cli.html" class="active"><strong aria-hidden="true">4.</strong> Command-line interface</a></li><li class="chapter-item expanded "><a href="contracts.html"><strong aria-hidden="true">5.</strong> Smart Contracts</a></li><li class="chapter-item expanded "><a href="circuits.html"><strong aria-hidden="true">6.</strong> Circuits</a></li><li class="chapter-item expanded "><a href="trustedsetup.html"><strong aria-hidden="true">7.</strong> Trusted setup</a></li><li class="chapter-item expanded "><a href="testing.html"><strong aria-hidden="true">8.</strong> Testing</a></li><li class="chapter-item expanded "><a href="integrating-maci.html"><strong aria-hidden="true">9.</strong> Integrating MACI</a></li><li class="chapter-item expanded "><a href="audit.html"><strong aria-hidden="true">10.</strong> Latest audit</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Minimum Anti-Collusion Infrastructure</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="command-line-interface"><a class="header" href="#command-line-interface">Command-line interface</a></h1>
<p>MACI provides a command-line interface that allows for effective deployment and
testing. Applications that build on top of MACI, such as
<a href="https://clr.fund/">clr.fund</a>, implement their own web UIs.</p>
<p>Note that all the example commands default to a local Ethereum testnet at
<code>http://localhost:8545</code>, and use the Ethereum private key
<code>0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3</code>. Do not
send any real funds to the address generated by this key.</p>
<p>For testing purposes, you can run:</p>
<pre><code class="language-bash"># in maci/contracts
npm run hardhat
</code></pre>
<h2 id="subcommands"><a class="header" href="#subcommands">Subcommands</a></h2>
<table><thead><tr><th>Role</th><th>Action</th><th>Subcommand</th></tr></thead><tbody>
<tr><td>User</td><td>Generate MACI keypair</td><td><code>genMaciKeypair</code></td></tr>
<tr><td>User</td><td>Generate MACI public key</td><td><code>genMaciPubkey</code></td></tr>
<tr><td>Coordinator</td><td>Deploy VkRegistry</td><td><code>deployVkRegistry</code></td></tr>
<tr><td>Coordinator</td><td>Set verifying keys</td><td><code>setVerifyingKeys</code></td></tr>
<tr><td>Coordinator</td><td>Create MACI instance</td><td><code>create </code></td></tr>
<tr><td>Coordinator</td><td>Deploy a new poll</td><td><code>deployPoll</code></td></tr>
<tr><td>Coordinator</td><td>Deploy a new poll processor and tallyer</td><td><code>deployPpt</code></td></tr>
<tr><td>User</td><td>Sign up</td><td><code>signup</code></td></tr>
<tr><td>User</td><td>Change key / vote</td><td><code>publish</code></td></tr>
<tr><td>Coordinator</td><td>Merge state tree</td><td><code>mergeSignups</code></td></tr>
<tr><td>Coordinator</td><td>Merge message tree</td><td><code>mergeMessages</code></td></tr>
<tr><td>Coordinator</td><td>Generate message processing and vote tallying proofs</td><td><code>genProofs</code></td></tr>
<tr><td>Coordinator</td><td>Submit proofs</td><td><code>proveOnChain</code></td></tr>
<tr><td>Coordinator</td><td>Process and tally all votes without producing proofs</td><td><code>processAndTallyWithoutProofs</code></td></tr>
<tr><td>Coordinator</td><td>Roll back message processing and vote tallying in the MACI contract</td><td><code>coordinatorReset</code></td></tr>
</tbody></table>
<h2 id="public-and-private-key-format"><a class="header" href="#public-and-private-key-format">Public and private key format</a></h2>
<p>MACI uses private keys in the BabyJub field for operations which occur within
zk-SNARKs, such as decrypting messages or signing commands. As MACI is deployed
on Ethereum, we seek to avoid confusing BabyJub private keys with Ethereum
private keys. To that end, users should pass serialized formats of public and
private keys to this CLI. We use <code>maci-domainobj</code>'s <code>PrivKey.serialize</code> and
<code>PubKey.serialize</code> functions to do so.</p>
<p>Examples of serialized public and private keys:</p>
<pre><code>Private key: macisk.49953af3585856f539d194b46c82f4ed54ec508fb9b882940cbe68bbc57e59e
Public key:  macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330
</code></pre>
<h3 id="coordinator-deploy-vkregistry"><a class="header" href="#coordinator-deploy-vkregistry">Coordinator: Deploy VkRegistry</a></h3>
<p>This command deploys an instance of a VkRegistry contract. Multiple MACI
contracts can refer to the same VkRegistry as long as they are all owned (via
<code>Ownable.sol</code>) by the same account.</p>
<p>Example usage:</p>
<pre><code class="language-bash">ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \
ETH_PROVIDER=http://localhost:8545 \
node build/index.js deployVkRegistry
</code></pre>
<p>Example output:</p>
<pre><code>VkRegistry: 0x8CdaF0CD259887258Bc13a92C0a6dA92698644C0
</code></pre>
<h3 id="coordinator-set-verifying-keys"><a class="header" href="#coordinator-set-verifying-keys">Coordinator: Set verifying keys</a></h3>
<p>Note that the filename of the <code>.zkey</code> files must follow this format:</p>
<pre><code>ProcessMessages_&lt;STATE_TREE_DEPTH&gt;-&lt;MSG_TREE_DEPTH&gt;-&lt;MSG_SUBTREE_DEPTH&gt;-&lt;VOTE_OPTION_TREE_DEPTH&gt;_test.&lt;CONTRIBUTION_NUM&gt;.zkey
TallyVotes_&lt;STATE_TREE_DEPTH&gt;-&lt;INT_STATE_TREE_DEPTH&gt;-&lt;VOTE_OPTION_TREE_DEPTH&gt;&gt;_test.&lt;CONTRIBUTION_NUM&gt;&gt;.zkey
</code></pre>
<p>Example usage:</p>
<pre><code class="language-bash">ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \
ETH_PROVIDER=http://localhost:8545 \
node build/index.js setVerifyingKeys \
    -s 10 -i 1 -m 2 -v 2 -b 1 \
    -p ./zkeys/ProcessMessages_10-2-1-2_test.0.zkey \
    -t ./zkeys/TallyVotes_10-1-2_test.0.zkey \
    -k 0x8CdaF0CD259887258Bc13a92C0a6dA92698644C0
</code></pre>
<p>Example output:</p>
<pre><code>Generating ./zkeys/ProcessMessages_10-2-1-2_test.0.zkey.vk.json, please wait...
Generating ./zkeys/TallyVotes_10-1-2_test.0.zkey.vk.json, please wait...
Transaction hash: 0x582631c36a4e21e0b65c3f9100c6343408c8683a36ded36fc02a9be07fa079e8
</code></pre>
<h3 id="coordinator-create-maci-instance"><a class="header" href="#coordinator-create-maci-instance">Coordinator: Create MACI instance</a></h3>
<p>Example usage:</p>
<pre><code class="language-bash">ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \
ETH_PROVIDER=http://localhost:8545 \
node build/index.js create -r 0x8CdaF0CD259887258Bc13a92C0a6dA92698644C0
</code></pre>
<p>Example output:</p>
<pre><code>Deploying InitialVoiceCreditProxy
Deploying Poseidon contracts
Linking Poseidon libraries to MACI
Linking Poseidon libraries to PollFactory
Linking Poseidon libraries to MessageAqFactory
Deploying MACI
Transferring PollFactory ownership to MACI
Transferring MessageAqFactory ownership to PollFactory
Initialising MACI
MACI: 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D
</code></pre>
<h3 id="coordinator-deploy-poll"><a class="header" href="#coordinator-deploy-poll">Coordinator: Deploy poll</a></h3>
<p>Example usage:</p>
<pre><code class="language-bash">ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \
ETH_PROVIDER=http://localhost:8545 \
node ./build/index.js deployPoll \
    -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D \
    -pk macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330 \
    -t 30 -g 25 -mv 25 -i 1 -m 2 -b 1 -v 2
</code></pre>
<p>Example output:</p>
<pre><code>Verifier: 0x5E70a420373D6BcB1ca3D08FEeB78a2F80727B29
Poll ID: 0
Poll contract: 0x710FA420C3bE4bb0730265d6581BDda11087A901
PollProcessorAndTallyer contract: 0x62C3204a98bbbd73C8fc3B8bfCDa467CB079dF47
</code></pre>
<h3 id="user-sign-up"><a class="header" href="#user-sign-up">User: sign up</a></h3>
<p>Example usage:</p>
<pre><code class="language-bash">ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \
ETH_PROVIDER=http://localhost:8545 \
node ./build/index.js signup \
    -p macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330 \
    -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D
</code></pre>
<p>Example output:</p>
<pre><code>Transaction hash: 0xcae04f618a0b45896732632121248c312cbc68584519c1e43932b110da9078bc
State index: 1
</code></pre>
<h3 id="user-publish-message"><a class="header" href="#user-publish-message">User: publish message</a></h3>
<p>Example usage:</p>
<pre><code class="language-bash">ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \
ETH_PROVIDER=http://localhost:8545 \
node build/index.js publish \
    -p macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330 \
    -sk macisk.2ae4f199bf3925a2407f7c775c9261f351ab861d8e9ecbb84622bdd3f6d41b08 \
    -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D \
    -i 1 -v 0 -w 9 -n 1 -o 0
</code></pre>
<h3 id="coordinator-merge-state-tree"><a class="header" href="#coordinator-merge-state-tree">Coordinator: merge state tree</a></h3>
<p>Example usage:</p>
<pre><code class="language-bash">ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \
ETH_PROVIDER=http://localhost:8545 \
node build/index.js mergeSignups -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D -o 0
</code></pre>
<h3 id="coordinator-merge-message-tree"><a class="header" href="#coordinator-merge-message-tree">Coordinator: merge message tree</a></h3>
<p>Example usage:</p>
<pre><code class="language-bash">ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \
ETH_PROVIDER=http://localhost:8545 \
node build/index.js mergeMessages -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D -o 0
</code></pre>
<h3 id="coordinator-generate-proofs"><a class="header" href="#coordinator-generate-proofs">Coordinator: generate proofs</a></h3>
<p>Example usage:</p>
<pre><code class="language-bash">node build/index.js genProofs -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D \
    -sk macisk.49953af3585856f539d194b46c82f4ed54ec508fb9b882940cbe68bbc57e59e \
    -o 0 \
    -t tally.json \
    -f proofs.json \
    -r ~/rapidsnark/build/prover \
    -wp ./zkeys/ProcessMessages_10-2-1-2_test \
    -wt ./zkeys/TallyVotes_10-1-2_test \
    -zp ./zkeys/ProcessMessages_10-2-1-2_test.0.zkey \
    -zt ./zkeys/TallyVotes_10-1-2_test.0.zkey \
</code></pre>
<h3 id="coordinator-prove-on-chain"><a class="header" href="#coordinator-prove-on-chain">Coordinator: prove on chain</a></h3>
<p>Example usage:</p>
<pre><code class="language-bash">node build/index.js proveOnChain \
    -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D \
    -o 0 \
    -q 0x62C3204a98bbbd73C8fc3B8bfCDa467CB079dF47 \
    -f proofs/
</code></pre>
<h3 id="anyone-verify-tally"><a class="header" href="#anyone-verify-tally">Anyone: verify tally</a></h3>
<p>Example usage:</p>
<pre><code class="language-bash">node build/index.js verify \
    -x 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \
    -o 0 \
    -t tally.json \
    -q 0x62C3204a98bbbd73C8fc3B8bfCDa467CB079dF47
</code></pre>
<h2 id="demonstration"><a class="header" href="#demonstration">Demonstration</a></h2>
<h3 id="scenario"><a class="header" href="#scenario">Scenario:</a></h3>
<ol>
<li>Alice votes for Party A</li>
<li>Alice changes her key</li>
<li>Eve tries to bribe Alice to change her vote to Party B</li>
<li>Alice submits an invalid vote for Party B</li>
<li>The coordinator processes the votes, computes, and verifies the final tally</li>
<li>The expected result is: Party A has some votes and Party B has 0 votes.</li>
</ol>
<p>Implication: Alice's invalid vote was not counted, and Eve had no way to tell.</p>
<h3 id="examples-of-serialized-public-and-private-keys"><a class="header" href="#examples-of-serialized-public-and-private-keys">Examples of serialized public and private keys:</a></h3>
<pre><code>Coordinator:
Private key: macisk.49953af3585856f539d194b46c82f4ed54ec508fb9b882940cbe68bbc57e59e
Public key:  macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330

Alice:
Private key: macisk.fd7aa614ec4a82716ffc219c24fd7e7b52a2b63b5afb17e81c22fe21515539c
Public key:  macipk.3e7bb2d7f0a1b7e980f1b6f363d1e3b7a12b9ae354c2cd60a9cfa9fd12917391
</code></pre>
<h3 id="coordinator-deploy-vkregistry-1"><a class="header" href="#coordinator-deploy-vkregistry-1">Coordinator: Deploy VkRegistry</a></h3>
<pre><code class="language-bash">node build/index.js deployVkRegistry
</code></pre>
<p>Output:</p>
<pre><code class="language-bash">VkRegistry: 0x8CdaF0CD259887258Bc13a92C0a6dA92698644C0
</code></pre>
<h3 id="coordinator-set-verifying-keys-1"><a class="header" href="#coordinator-set-verifying-keys-1">Coordinator: Set verifying keys</a></h3>
<pre><code class="language-bash">node build/index.js setVerifyingKeys \
    --vk_registry 0x8CdaF0CD259887258Bc13a92C0a6dA92698644C0 \
    --state-tree-depth 10 \
    --int-state-tree-depth 1 \
    --msg-tree-depth 2 \
    --vote-option-tree-depth 2 \
    --msg-batch-depth 1 \
    --process-messages-zkey ./zkeys/ProcessMessages_10-2-1-2_test.0.zkey \
    --tally-votes-zkey ./zkeys/TallyVotes_10-1-2_test.0.zkey
</code></pre>
<p>Output:</p>
<pre><code class="language-bash">Setting verifying keys...
Transaction hash: 0x16236fe5e124f3d0c33ddf20a37ceba9730a659630258a1e858b3e335e057b8e
</code></pre>
<h3 id="coordinator-create-maci-instance-1"><a class="header" href="#coordinator-create-maci-instance-1">Coordinator: Create MACI instance</a></h3>
<pre><code class="language-bash">node build/index.js create \
    --vk-registry 0x8CdaF0CD259887258Bc13a92C0a6dA92698644C0
</code></pre>
<p>Output:</p>
<pre><code class="language-bash">Deploying InitialVoiceCreditProxy
Deploying Poseidon contracts
Linking Poseidon libraries to MACI
Linking Poseidon libraries to PollFactory
Linking Poseidon libraries to MessageAqFactory
Deploying MACI
Transferring PollFactory ownership to MACI
Transferring MessageAqFactory ownership to PollFactory
Initialising MACI
MACI: 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a
</code></pre>
<h3 id="coordinator-deploy-poll-1"><a class="header" href="#coordinator-deploy-poll-1">Coordinator: Deploy poll</a></h3>
<pre><code class="language-bash">node ./build/index.js deployPoll \
    --maci-address 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \
    --pubkey macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330 \
    --duration 1000 \
    --max-messages 25 \
    --max-vote-options 25 \
    --int-state-tree-depth 1 \
    --msg-tree-depth 2 \
    --msg_batch_depth 1 \
    --vote-option-tree-depth 2
</code></pre>
<p>Output:</p>
<pre><code class="language-bash">Verifier: 0x0d8cc4b8d15D4c3eF1d70af0071376fb26B5669b
Poll ID: 0
Poll contract: 0x08e8f54262de52fe7Dfd0Bc0C9Ea87689d70e985
PollProcessorAndTallyer contract: 0xEcFcaB0A285d3380E488A39B4BB21e777f8A4EaC
</code></pre>
<h3 id="alice-sign-up"><a class="header" href="#alice-sign-up">Alice: sign up</a></h3>
<pre><code class="language-bash">node ./build/index.js signup \
    --pubkey macipk.3e7bb2d7f0a1b7e980f1b6f363d1e3b7a12b9ae354c2cd60a9cfa9fd12917391 \
    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a
</code></pre>
<p>Output:</p>
<pre><code class="language-bash">Transaction hash: 0xcdff1e0cd3021cdc3ba2c65cfd74bac3715c32efdd2052c0e8f3a677a81a758b
State index: 1
</code></pre>
<h3 id="alice-votes-for-party-a-option-index-0"><a class="header" href="#alice-votes-for-party-a-option-index-0">Alice: votes for Party A (option index 0)</a></h3>
<pre><code class="language-bash">node build/index.js publish \
    --pubkey macipk.3e7bb2d7f0a1b7e980f1b6f363d1e3b7a12b9ae354c2cd60a9cfa9fd12917391 \
    --privkey macisk.fd7aa614ec4a82716ffc219c24fd7e7b52a2b63b5afb17e81c22fe21515539c \
    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \
    --state-index 1 \
    --vote-option-index 0 \
    --new-vote-weight 9 \
    --nonce 1 \
    --poll-id 0
</code></pre>
<p>Output:</p>
<pre><code class="language-bash">Transaction hash: 0xc0964069834b171bb698ffc61e31e1be456c740ff1967ccad7d8cd8ed362e545
Ephemeral private key: macisk.1bf4bba7086c213606bb4a775b1ceaa4c2e7119c329748e675375f0d79c900dc
</code></pre>
<h3 id="alice-submits-an-invalid-vote-for-party-b-option-index-1-with-different-public-key"><a class="header" href="#alice-submits-an-invalid-vote-for-party-b-option-index-1-with-different-public-key">Alice: submits an invalid vote for Party B (option index 1) with different public key</a></h3>
<pre><code class="language-bash">node build/index.js publish \
    --pubkey macipk.d5788ea6ccf1ec295df99aaef859031fe7bd359e7e03acb80eb6e8a192f2ce19 \
    --privkey macisk.fd7aa614ec4a82716ffc219c24fd7e7b52a2b63b5afb17e81c22fe21515539c \
    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \
    --state-index 1 \
    --vote-option-index 1 \
    --new-vote-weight 9 \
    --nonce 2 \
    --poll-id 0
</code></pre>
<p>Output:</p>
<pre><code class="language-bash">Transaction hash: 0xc13b97e23b387d8c160e0f8b1bfb33dc0ff4441fe63a37f0fc3ec84a0cfa0600
Ephemeral private key: macisk.5bc9f217a29c5defad1ca9be3d649add1eca30037589527476e8335b24cf75b
</code></pre>
<p>Time Travel</p>
<pre><code>node build timeTravel -s 1000
</code></pre>
<h3 id="coordinator-merge-state-tree-1"><a class="header" href="#coordinator-merge-state-tree-1">Coordinator: merge state tree</a></h3>
<pre><code class="language-bash">node build/index.js mergeSignups \
    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \
    --poll-id 0
</code></pre>
<p>Output:</p>
<pre><code class="language-bash">Merging state subroots 1 / 1
Executed mergeMaciStateAqSubRoots(); gas used: 723525
Transaction hash: 0x14621b208fdadbf277edf80b393f1a9694099ae9676903e148fa485eecfadd4b

All state subtrees have been merged.
Merging subroots to a main state root...
Executed mergeStateAq(); gas used: 1015876
Transaction hash: 0xf2903b1c3c83b87c551a71f29e07762b464691ca58b0c6849b2f9b8f5783011f
The state tree has been merged.
</code></pre>
<h3 id="coordinator-merge-message-tree-1"><a class="header" href="#coordinator-merge-message-tree-1">Coordinator: merge message tree</a></h3>
<pre><code class="language-bash">node build/index.js mergeMessages \
    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \
    --poll-id 0
</code></pre>
<p>Output:</p>
<pre><code class="language-bash">Merging message subroots 1 / 1
Executed mergeMaciStateAqSubRoots(); gas used: 604387
Transaction hash: 0xe0c0306b80febe1f6947b6ccbefabef38d01abce0b7611f49ce1cc7e20f196a5

All message subtrees have been merged.
Merging subroots to a main message root...
Executed mergeMessageAq(); gas used: 174376
Transaction hash: 0x424581f08d5f8e9f4fd63b083f9446cc2bff3b8e4b67ebc834076d6e9c34ec20
The message tree has been merged.
</code></pre>
<h3 id="coordinator-generate-proofs-1"><a class="header" href="#coordinator-generate-proofs-1">Coordinator: generate proofs</a></h3>
<pre><code class="language-bash">node build/index.js genProofs \
    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \
    --privkey macisk.49953af3585856f539d194b46c82f4ed54ec508fb9b882940cbe68bbc57e59e \
    --poll-id 0 \
    --tally-file tally.json \
    --output proofs \
    --rapidsnark ~/rapidsnark/build/prover \
    --process-witnessgen ./zkeys/ProcessMessages_10-2-1-2_test \
    --tally-witnessgen ./zkeys/TallyVotes_10-1-2_test \
    --process-zkey ./zkeys/ProcessMessages_10-2-1-2_test.0.zkey \
    --tally-zkey ./zkeys/TallyVotes_10-1-2_test.0.zkey
</code></pre>
<p>Output:</p>
<pre><code class="language-bash">fromBlock = 0
Generating proofs of message processing...

Progress: 1 / 1

Generating proofs of vote tallying...

Progress: 1 / 1

OK
</code></pre>
<h3 id="coordinator-prove-on-chain-1"><a class="header" href="#coordinator-prove-on-chain-1">Coordinator: prove on chain</a></h3>
<pre><code class="language-bash">node build/index.js proveOnChain \
    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \
    --poll-id 0 \
    --ppt 0xEcFcaB0A285d3380E488A39B4BB21e777f8A4EaC \
    --proof-dir proofs/
</code></pre>
<p>Output:</p>
<pre><code class="language-bash">Submitting proofs of message processing...
Transaction hash: 0x59388e69899612390ef22de235629e9355e14f888bb330b46511cc06d8f2035d
Progress: 1 / 1
All message processing proofs have been submitted.

Submitting proofs of vote tallying...
Progress: 1 / 1
Transaction hash: 0xc90e3bd0618def86b709c995485271f806c60701a3f4246903498f27346b9f5e
All vote tallying proofs have been submitted.

OK
</code></pre>
<h3 id="anyone-verify"><a class="header" href="#anyone-verify">Anyone: verify</a></h3>
<pre><code class="language-bash">node build/index.js verify \
    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \
    --poll-id 0 \
    --tally-file tally.json \
    --ppt 0xEcFcaB0A285d3380E488A39B4BB21e777f8A4EaC
</code></pre>
<p>Output:</p>
<pre><code class="language-bash">{
  provider: 'http://localhost:8545',
  maci: '0xf204a4Ef082f5c04bB89F7D5E6568B796096735a',
  pollId: 0,
  newTallyCommitment: '0x29b47e79c10709047ba9788580c2dc8528f003eab42d30670df78a47b121aa6c',
  results: {
    tally: [
      '9', '0', '0', '0', '0', '0',
      '0', '0', '0', '0', '0', '0',
      '0', '0', '0', '0', '0', '0',
      '0', '0', '0', '0', '0', '0',
      '0'
    ],
    salt: '0x132065c8ad3968008aeb7c114a04de228fa5b3618743ad00f64ad3f773a2e4d2'
  },
  totalSpentVoiceCredits: {
    spent: '81',
    salt: '0x2940f93e085350a04f6ff85e1ebffbc391fc3498f1cb41ab47f8899dc9c6efc6'
  },
  perVOSpentVoiceCredits: {
    tally: [
      '81', '0', '0', '0', '0', '0',
      '0',  '0', '0', '0', '0', '0',
      '0',  '0', '0', '0', '0', '0',
      '0',  '0', '0', '0', '0', '0',
      '0'
    ],
    salt: '0x2db5c3d6b015f8e2ea1cf7ffed7a44af0db8a8c09a5077415c076b6ebcee0571'
  }
}
OK
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="primitives.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="contracts.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="primitives.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="contracts.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
